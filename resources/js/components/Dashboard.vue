<template>
    <section class="content">
        <div class="container-fluid">
            <div class="row ">
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box">
                        <span class="info-box-icon bg-info elevation-1"><i class="fas fa-cog"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">CPU Traffic</span>
                            <span class="info-box-number">
                            10
                            <small>%</small>
                            </span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box mb-3">
                        <span class="info-box-icon bg-danger elevation-1"><i class="fas fa-thumbs-up"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">Likes</span>
                            <span class="info-box-number">41,410</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->

                <!-- fix for small devices only -->
                <div class="clearfix hidden-md-up"></div>

                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box mb-3">
                        <span class="info-box-icon bg-success elevation-1"><i class="fas fa-shopping-cart"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">Sales</span>
                            <span class="info-box-number">760</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box mb-3">
                        <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-users"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">New Members</span>
                            <span class="info-box-number">2,000</span>
                        </div>
                    <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
            <!-- /.col -->
            </div>
            <!-- /.row -->

            <div class="row">
                <!-- Left col -->
                <div class="col-md-8">
                    <!-- MAP & BOX PANE -->
                    <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Latest Orders (Demo)</h3>

                        <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-tool" data-card-widget="remove">
                            <i class="fas fa-times"></i>
                        </button>
                        </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body p-0">
                        <div class="table-responsive">
                        <table class="table m-0">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Item</th>
                                    <th>Status</th>
                                    <th>Popularity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><a href="pages/examples/invoice.html">OR9842</a></td>
                                    <td>Call of Duty IV</td>
                                    <td><span class="badge badge-success">Shipped</span></td>
                                    <td>
                                        <div class="sparkbar" data-color="#00a65a" data-height="20">90,80,90,-70,61,-83,63</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="pages/examples/invoice.html">OR1848</a></td>
                                    <td>Samsung Smart TV</td>
                                    <td><span class="badge badge-warning">Pending</span></td>
                                    <td>
                                        <div class="sparkbar" data-color="#f39c12" data-height="20">90,80,-90,70,61,-83,68</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="pages/examples/invoice.html">OR7429</a></td>
                                    <td>iPhone 6 Plus</td>
                                    <td><span class="badge badge-danger">Delivered</span></td>
                                    <td>
                                        <div class="sparkbar" data-color="#f56954" data-height="20">90,-80,90,70,-61,83,63</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="pages/examples/invoice.html">OR7429</a></td>
                                    <td>Samsung Smart TV</td>
                                    <td><span class="badge badge-info">Processing</span></td>
                                    <td>
                                        <div class="sparkbar" data-color="#00c0ef" data-height="20">90,80,-90,70,-61,83,63</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="pages/examples/invoice.html">OR1848</a></td>
                                    <td>Samsung Smart TV</td>
                                    <td><span class="badge badge-warning">Pending</span></td>
                                    <td>
                                        <div class="sparkbar" data-color="#f39c12" data-height="20">90,80,-90,70,61,-83,68</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="pages/examples/invoice.html">OR7429</a></td>
                                    <td>iPhone 6 Plus</td>
                                    <td><span class="badge badge-danger">Delivered</span></td>
                                    <td>
                                        <div class="sparkbar" data-color="#f56954" data-height="20">90,-80,90,70,-61,83,63</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        </div>
                    </div>
                <!-- /.card-body -->
                </div>
                <!-- /.card -->
                <!-- /.card -->
            </div>
            <!-- /.col -->

            <div class="col-md-4">
                <!-- Info Boxes Style 2 -->
                <div class="info-box mb-3 bg-secondary">
                <span class="info-box-icon"><i class="fas fa-tag"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Inventory</span>
                    <span class="info-box-number">5,200</span>
                </div>
                <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
                <div class="info-box mb-3 bg-success">
                <span class="info-box-icon"><i class="far fa-heart"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Mentions</span>
                    <span class="info-box-number">92,050</span>
                </div>
                <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
                <div class="info-box mb-3 bg-danger">
                <span class="info-box-icon"><i class="fas fa-cloud-download-alt"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Downloads</span>
                    <span class="info-box-number">114,381</span>
                </div>
                <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
                <div class="info-box mb-3 bg-info">
                <span class="info-box-icon"><i class="far fa-comment"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Direct Messages</span>
                    <span class="info-box-number">163,921</span>
                </div>
                <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
            <!-- /.col -->
            </div>
            <!-- /.row -->
        </div><!--/. container-fluid -->

        <div class="row">
            <div class="col-6">
                <label
                    v-text="this.region"
                    :for="this.region"
                    class="d-block text-capitalize"></label>

                <v-select
                    v-model="selectedRegion"
                    @input="selectedRegionUpdate"
                    label="regionName"
                    :options="regions"
                    :placeholder="`Select a ${this.region}`"></v-select>
                <!-- <select
                    v-model="selectedRegion"
                    :name="this.region"
                    :id="`select-${this.region}`"
                    class="form-control">
                    <option
                        v-text="`Select a ${this.region}`"
                        value=""></option>
                    <option
                        v-for="region in regions"
                        v-text="`${region.regionName} (${region.name })`"
                        :value="region">
                    </option>
                </select> -->
            </div>

            <div
                v-if="!this.isNcrTheSelectedRegion()"
                class="col-6">
                <label
                    v-text="this.province"
                    :for="this.province"
                    class="d-block text-capitalize"
                    :class="this.selectedRegion ? '' : 'text-muted'"></label>

                <v-select
                    v-model="selectedProvince"
                    @input="selectedProvinceUpdate"
                    label="name"
                    :options="provinces"
                    :disabled="this.selectedRegion === ''"
                    :placeholder="`Select a ${this.province}`"></v-select>
                <!-- <select
                    v-model="selectedProvince"
                    :name="this.province"
                    :id="`select-${this.province}`"
                    :disabled="this.selectedRegion === ''"
                    class="form-control">
                    <option
                        v-text="`Select a ${this.province}`"
                        value=""></option>
                    <option
                        v-for="province in provinces"
                        v-text="province.name"
                        :value="province">
                    </option>
                </select> -->
            </div>

            <div class="col-6">
                <label
                    v-text="this.isNcrTheSelectedRegion() ? this.city : this.district"
                    :for="this.district"
                    class="d-block text-capitalize"
                    :class="this.selectedProvince ? '' : 'text-muted'"></label>

                <v-select
                    v-model="selectedDistrict"
                    @input="selectedDistrictUpdate"
                    label="name"
                    :options="districts"
                    :disabled="this.isNcrTheSelectedRegion() ? false : this.selectedProvince === ''"
                    :placeholder="`Select a ${this.isNcrTheSelectedRegion() ? this.city : this.district}`"></v-select>
                <!-- <select
                    v-model="selectedDistrict"
                    :name="this.district"
                    :id="`select-${this.district}`"
                    :disabled="this.isNcrTheSelectedRegion() ? false : this.selectedProvince === ''"
                    class="form-control">
                    <option
                        v-text="`Select a ${this.isNcrTheSelectedRegion() ? this.city : this.district}`"
                        value=""></option>
                    <option
                        v-for="district in districts"
                        v-text="district.name"
                        :value="district">
                    </option>
                </select> -->
            </div>

            <div class="col-6">
                <label
                    v-text="this.barangay"
                    :for="this.barangay"
                    class="d-block text-capitalize"
                    :class="this.selectedDistrict ? '' : 'text-muted'"></label>

                <v-select
                    v-model="selectedBarangay"
                    label="name"
                    :options="barangays"
                    :disabled="this.selectedDistrict === ''"
                    :placeholder="`Select a ${this.barangay}`"></v-select>
               <!--  <select
                    v-model="selectedBarangay"
                    :name="this.barangay"
                    :id="`select-${this.barangay}`"
                    :disabled="this.selectedDistrict === ''"
                    class="form-control">
                    <option
                        v-text="`Select a ${this.barangay}`"
                        value=""></option>
                    <option
                        v-for="barangay in barangays"
                        v-text="barangay.name"
                        :value="barangay">
                    </option>
                </select> -->
            </div>
        </div>
    </section>
</template>

<script>
    import 'vue-select/dist/vue-select.css';
    import _ from 'lodash';

    export default {
        props: {
            selectedRegionProperty: {
                type: String,
                default: ""
            },
            selectedProvinceProperty: {
                type: String,
                default: ""
            },
            selectedDistrictProperty: {
                type: String,
                default: ""
            },
            selectedCityProperty: {
                type: String,
                default: ""
            },
            selectedMunicipalityProperty: {
                type: String,
                default: ""
            },
            selectedBarangayProperty: {
                type: String,
                default: ""
            }
        },
        data: function () {
            return {
                selectedRegion: this.selectedRegionProperty,
                selectedProvince: this.selectedProvinceProperty,
                selectedDistrict: this.selectedDistrictProperty,
                selectedCity: this.selectedCityProperty,
                selectedMunicipality: this.selectedMunicipalityProperty,
                selectedBarangay: this.selectedBarangayProperty,
                regions: [],
                provinces: [],
                districts: [],
                cities: [],
                municipalities: [],
                barangays: [],
                region: "region",
                // region: "regions",
                province: "province",
                // province: "provinces",
                district: "district",
                division: "",
                city: "city",
                // city: "cities",
                municipality: "municipality",
                // municipality: "municipalities",
                barangay: "barangay",
                // barangay: "barangays",
            };
        },
        watch: {
            selectedRegion: function (newSelectedRegion, oldSelectedRegion) {
                // this.updateDivision();
                this.debouncedSelectedRegionUpdate(newSelectedRegion);
            },
            selectedProvince: function (newSelectedProvince, oldSelectedProvince) {
                // this.updateDivision();
                this.debouncedSelectedProvinceUpdate(newSelectedProvince);
            },
            selectedDistrict: function (newSelectedDistrict, oldSelectedDistrict) {
                this.debouncedSelectedDistrictUpdate(newSelectedDistrict);
            }
            // selectedCity: function (newSelectedCity, oldSelectedCity) {
            //     // const value = this.isNcrTheSelectedRegion() ? this.selectedRegion : newSelectedCity

            //     // this.debouncedSelectedCityUpdate(value);
            //     this.debouncedSelectedCityUpdate(newSelectedCity);
            // },
            // selectedMunicipality: function (newSelectedMunicipality, oldSelectedMunicipality) {
            //     this.debouncedSelectedMunicipalityUpdate(newSelectedMunicipality);
            // }
        },
        created: function () {
            //1s delay
            const debounce = 1000;

            this.debouncedSelectedRegionUpdate =  _.debounce(this.selectedRegionUpdate, debounce);
            this.debouncedSelectedProvinceUpdate =  _.debounce(this.selectedProvinceUpdate, debounce);
            this.debouncedSelectedDistrictUpdate =  _.debounce(this.selectedDistrictUpdate, debounce);
            // this.debouncedSelectedCityUpdate =  _.debounce(this.selectedCityOrMunicipalityUpdate, debounce);
            // this.debouncedSelectedMunicipalityUpdate =  _.debounce(this.selectedCityOrMunicipalityUpdate, debounce);
        },
        async mounted() {
            const response = await this.getData(`${this.region}`);
            this.regions = response.data.data ?? [];
        },
        methods: {
            getData(url) {
                url = "/api/" + url;

                return axios.get(url)
                    .then(function (response) {
                        return response;
                    })
                    .catch(function (error) {
                        // console.log("error:", error);
                    });
            },
            isNcrTheSelectedRegion: function () {
                if (_.isEmpty(this.selectedRegion)) return false;

                return this.selectedRegion.name === "NCR";
            },
            // updateDivision: function () {

            //     if (this.selectedRegion) {
            //         this.division =  this.isNcrTheSelectedRegion ? this.city : this.municipality;
            //     } else {
            //         this.division = "";
            //     }
            // },
            selectedRegionUpdate: async function (value) {
                this.selectedProvince = "";
                this.selectedDistrict = "";
                // this.selectedCity = "";
                // this.selectedMunicipality = "";
                this.selectedBarangay = "";

                if (! value) return this.selectedRegion = "";
                // this.provinces = this.districts = this.barangays = [];

                var response = [];

                if (this.isNcrTheSelectedRegion()) {
                    response = await this.getData(`${this.region}/${value.code}/${this.district}`);

                    this.districts = response.data.data;
                    this.provinces = [];
                } else {
                    response = await this.getData(`${this.region}/${value.code}/${this.province}`);

                    this.provinces = response.data.data;
                    // this.districts = [];
                }
            },
            selectedProvinceUpdate: async function (value) {
                // this.selectedCity = "";
                // this.selectedMunicipality = "";
                this.selectedDistrict = "";
                this.selectedBarangay = "";

                if (! value) return this.selectedProvince = "";
                // this.districts = this.barangays = [];

                const response = await this.getData(`${this.province}/${value.code}/${this.district}`);

                this.districts = response.data.data;

                // if (_.isEmpty(this.division)) return;

                // const response = await this.getData(`${this.province}/${value.code}/${this.division}`);

                // const cits = await this.getData(`${this.province}/${value.code}/city`);

                // console.log(['cities', cits.data.data, `${this.province}/${value.code}/city`]);

                // const muns = await this.getData(`${this.province}/${value.code}/municipality`);

                // console.log(['munis', muns.data.data]);

                // const data = response.data.data ?? [];
                // console.log(data);

                // if (this.division === this.city) {
                //     this.cities = data;
                //     this.municipalities = [];
                // } else {
                //     this.municipalities = data;
                //     this.cities = [];
                // }
            },
            selectedDistrictUpdate: async function (value) {
                this.selectedBarangay = "";

                if (! value) return this.selectedDistrict = "";
                // this.barangays = [];

                const response = await this.getData(`${this.district}/${value.code}/${this.barangay}`);

                this.barangays = response.data.data;
            }
            // selectedCityOrMunicipalityUpdate: async function (value) {
            //     this.selectedBarangay = "";

            //     const response = await this.getData(`${this.division}/${value.code}/${this.barangay}`);
            //     this.barangays = response.data.data ?? [];
            //     console.log(`${this.division}/${value.code}/${this.barangay}`, response);
            // }
        }
    }
</script>
